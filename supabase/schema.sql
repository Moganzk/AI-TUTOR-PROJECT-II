| definition                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| CREATE TABLE ai_interactions (
  completion_tokens integer DEFAULT 0,
  total_tokens integer DEFAULT 0,
  feedback_comment text,
  model_used text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  feedback_rating integer,
  response_time_ms integer,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_id uuid NOT NULL,
  user_id uuid NOT NULL,
  prompt_tokens integer DEFAULT 0
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| CREATE UNIQUE INDEX ai_interactions_pkey ON public.ai_interactions USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ALTER TABLE ai_interactions ADD CONSTRAINT ai_interactions_user_id_fkey FOREIGN KEY (user_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ALTER TABLE ai_interactions ADD CONSTRAINT ai_interactions_session_id_fkey FOREIGN KEY (session_id) REFERENCES chat_sessions(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| CREATE TABLE assignment_answers (
  answer_text text,
  selected_option text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  question_id uuid NOT NULL,
  submission_id uuid NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid()
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| CREATE UNIQUE INDEX assignment_answers_pkey ON public.assignment_answers USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| CREATE UNIQUE INDEX assignment_answers_submission_id_question_id_key ON public.assignment_answers USING btree (submission_id, question_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ALTER TABLE assignment_answers ADD CONSTRAINT assignment_answers_question_id_fkey FOREIGN KEY (question_id) REFERENCES assignment_questions(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ALTER TABLE assignment_answers ADD CONSTRAINT assignment_answers_submission_id_fkey FOREIGN KEY (submission_id) REFERENCES assignment_submissions(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| CREATE TABLE assignment_comments (
  commenter_id uuid NOT NULL,
  line_number integer,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  is_private boolean DEFAULT false,
  comment_type text DEFAULT 'general'::text,
  comment text NOT NULL,
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  submission_id uuid NOT NULL
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| CREATE INDEX idx_comments_submission_id ON public.assignment_comments USING btree (submission_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| CREATE UNIQUE INDEX assignment_comments_pkey ON public.assignment_comments USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ALTER TABLE assignment_comments ADD CONSTRAINT assignment_comments_submission_id_fkey FOREIGN KEY (submission_id) REFERENCES assignment_submissions(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ALTER TABLE assignment_comments ADD CONSTRAINT assignment_comments_commenter_id_fkey FOREIGN KEY (commenter_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| CREATE TABLE assignment_extensions (
  assignment_id uuid NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  student_id uuid NOT NULL,
  granted_by uuid NOT NULL,
  original_due_date timestamp with time zone NOT NULL,
  extended_due_date timestamp with time zone NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  reason text
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| CREATE UNIQUE INDEX assignment_extensions_assignment_id_student_id_key ON public.assignment_extensions USING btree (assignment_id, student_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE UNIQUE INDEX assignment_extensions_pkey ON public.assignment_extensions USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ALTER TABLE assignment_extensions ADD CONSTRAINT assignment_extensions_student_id_fkey FOREIGN KEY (student_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ALTER TABLE assignment_extensions ADD CONSTRAINT assignment_extensions_granted_by_fkey FOREIGN KEY (granted_by) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ALTER TABLE assignment_extensions ADD CONSTRAINT assignment_extensions_assignment_id_fkey FOREIGN KEY (assignment_id) REFERENCES assignments(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| CREATE TABLE assignment_grades (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  is_final boolean DEFAULT false,
  percentage numeric,
  points_earned numeric,
  rubric_scores jsonb DEFAULT '[]'::jsonb,
  graded_by uuid NOT NULL,
  graded_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  submission_id uuid NOT NULL,
  feedback text,
  letter_grade text,
  returned_at timestamp with time zone
);                                                                                                                                                                                                                                                                                                                                                           |
| CREATE INDEX idx_grades_graded_by ON public.assignment_grades USING btree (graded_by);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| CREATE UNIQUE INDEX assignment_grades_pkey ON public.assignment_grades USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| CREATE UNIQUE INDEX assignment_grades_submission_id_key ON public.assignment_grades USING btree (submission_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| CREATE INDEX idx_grades_submission_id ON public.assignment_grades USING btree (submission_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ALTER TABLE assignment_grades ADD CONSTRAINT assignment_grades_submission_id_fkey FOREIGN KEY (submission_id) REFERENCES assignment_submissions(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ALTER TABLE assignment_grades ADD CONSTRAINT assignment_grades_graded_by_fkey FOREIGN KEY (graded_by) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| CREATE TABLE assignment_questions (
  correct_answer text,
  assignment_id uuid NOT NULL,
  options ARRAY,
  question_type text NOT NULL,
  question_text text NOT NULL,
  points integer DEFAULT 1,
  order_index integer NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  id uuid NOT NULL DEFAULT gen_random_uuid()
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| CREATE UNIQUE INDEX assignment_questions_pkey ON public.assignment_questions USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| CREATE INDEX idx_assignment_questions_assignment_order ON public.assignment_questions USING btree (assignment_id, order_index);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ALTER TABLE assignment_questions ADD CONSTRAINT assignment_questions_assignment_id_fkey FOREIGN KEY (assignment_id) REFERENCES assignments(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE TABLE assignment_submissions (
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  assignment_id uuid NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  content text,
  file_urls ARRAY,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  late_minutes integer DEFAULT 0,
  is_late boolean DEFAULT false,
  submitted_at timestamp with time zone,
  student_id uuid NOT NULL,
  attempt_number integer DEFAULT 1,
  status text NOT NULL DEFAULT 'draft'::text
);                                                                                                                                                                                                                                                                                                                                                                                                                  |
| CREATE INDEX idx_submissions_submitted_at ON public.assignment_submissions USING btree (submitted_at);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| CREATE INDEX idx_submissions_status ON public.assignment_submissions USING btree (status);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| CREATE INDEX idx_submissions_student_assignment ON public.assignment_submissions USING btree (student_id, assignment_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| CREATE UNIQUE INDEX assignment_submissions_pkey ON public.assignment_submissions USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| CREATE UNIQUE INDEX assignment_submissions_assignment_id_student_id_attempt_num_key ON public.assignment_submissions USING btree (assignment_id, student_id, attempt_number);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| CREATE INDEX idx_submissions_assignment_id ON public.assignment_submissions USING btree (assignment_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| CREATE INDEX idx_submissions_student_id ON public.assignment_submissions USING btree (student_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ALTER TABLE assignment_submissions ADD CONSTRAINT assignment_submissions_student_id_fkey FOREIGN KEY (student_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| ALTER TABLE assignment_submissions ADD CONSTRAINT assignment_submissions_assignment_id_fkey FOREIGN KEY (assignment_id) REFERENCES assignments(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| CREATE TABLE assignments (
  time_limit_minutes integer,
  is_published boolean DEFAULT false,
  requires_file_upload boolean DEFAULT false,
  max_file_size_mb integer DEFAULT 10,
  rubric jsonb DEFAULT '[]'::jsonb,
  auto_grade boolean DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  points_possible integer,
  subject text,
  allowed_file_types ARRAY,
  max_attempts integer DEFAULT 1,
  instructions text,
  status text DEFAULT 'draft'::text,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  course_id uuid NOT NULL,
  lesson_id uuid,
  created_by uuid NOT NULL,
  max_points integer DEFAULT 100,
  due_date timestamp with time zone,
  allow_late_submission boolean DEFAULT true,
  late_penalty_percent integer DEFAULT 0,
  description text,
  title text NOT NULL,
  assignment_type text NOT NULL
); |
| CREATE INDEX idx_assignments_published ON public.assignments USING btree (is_published);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| CREATE INDEX idx_assignments_course_due_date ON public.assignments USING btree (course_id, due_date);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| CREATE UNIQUE INDEX assignments_pkey ON public.assignments USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| CREATE INDEX idx_assignments_course_id ON public.assignments USING btree (course_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| CREATE INDEX idx_assignments_due_date ON public.assignments USING btree (due_date);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ALTER TABLE assignments ADD CONSTRAINT assignments_course_id_fkey FOREIGN KEY (course_id) REFERENCES courses(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ALTER TABLE assignments ADD CONSTRAINT assignments_lesson_id_fkey FOREIGN KEY (lesson_id) REFERENCES lessons(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ALTER TABLE assignments ADD CONSTRAINT assignments_created_by_fkey FOREIGN KEY (created_by) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| CREATE TABLE chat_sessions (
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  title text NOT NULL DEFAULT 'New Chat'::text,
  subject text,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now())
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE INDEX idx_chat_sessions_user_id ON public.chat_sessions USING btree (user_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| CREATE UNIQUE INDEX chat_sessions_pkey ON public.chat_sessions USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ALTER TABLE chat_sessions ADD CONSTRAINT chat_sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE TABLE course_enrollments (
  progress_percentage integer DEFAULT 0,
  completed_at timestamp with time zone,
  enrolled_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  student_id uuid NOT NULL,
  course_id uuid NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid()
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| CREATE UNIQUE INDEX course_enrollments_pkey ON public.course_enrollments USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| CREATE UNIQUE INDEX course_enrollments_course_id_student_id_key ON public.course_enrollments USING btree (course_id, student_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ALTER TABLE course_enrollments ADD CONSTRAINT course_enrollments_student_id_fkey FOREIGN KEY (student_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ALTER TABLE course_enrollments ADD CONSTRAINT course_enrollments_course_id_fkey FOREIGN KEY (course_id) REFERENCES courses(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE TABLE courses (
  estimated_hours integer,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  is_active boolean DEFAULT true,
  level text,
  thumbnail_url text,
  description text,
  title text NOT NULL,
  instructor_id uuid NOT NULL,
  subject_id uuid,
  duration_weeks integer
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| CREATE UNIQUE INDEX courses_pkey ON public.courses USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ALTER TABLE courses ADD CONSTRAINT courses_subject_id_fkey FOREIGN KEY (subject_id) REFERENCES subjects(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| ALTER TABLE courses ADD CONSTRAINT courses_instructor_id_fkey FOREIGN KEY (instructor_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE TABLE lesson_progress (
  student_id uuid NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  lesson_id uuid NOT NULL,
  completed_at timestamp with time zone,
  time_spent_minutes integer DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  notes text
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| CREATE UNIQUE INDEX lesson_progress_pkey ON public.lesson_progress USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| CREATE UNIQUE INDEX lesson_progress_lesson_id_student_id_key ON public.lesson_progress USING btree (lesson_id, student_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ALTER TABLE lesson_progress ADD CONSTRAINT lesson_progress_student_id_fkey FOREIGN KEY (student_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ALTER TABLE lesson_progress ADD CONSTRAINT lesson_progress_lesson_id_fkey FOREIGN KEY (lesson_id) REFERENCES lessons(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| CREATE TABLE lessons (
  course_id uuid NOT NULL,
  content text,
  lesson_order integer NOT NULL,
  video_url text,
  duration_minutes integer,
  is_published boolean DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title text NOT NULL
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| CREATE UNIQUE INDEX lessons_pkey ON public.lessons USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ALTER TABLE lessons ADD CONSTRAINT lessons_course_id_fkey FOREIGN KEY (course_id) REFERENCES courses(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| CREATE TABLE messages (
  user_id uuid NOT NULL,
  content text NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  role text NOT NULL,
  recipient_id uuid,
  sender_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  session_id uuid NOT NULL
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| CREATE INDEX idx_messages_created_at ON public.messages USING btree (created_at);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| CREATE INDEX idx_messages_recipient_id ON public.messages USING btree (recipient_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| CREATE INDEX idx_messages_sender_id ON public.messages USING btree (sender_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE INDEX idx_messages_conversation ON public.messages USING btree (sender_id, recipient_id, created_at);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| CREATE INDEX idx_messages_session_id ON public.messages USING btree (session_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| CREATE UNIQUE INDEX messages_pkey ON public.messages USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| ALTER TABLE messages ADD CONSTRAINT messages_recipient_id_fkey FOREIGN KEY (recipient_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ALTER TABLE messages ADD CONSTRAINT messages_session_id_fkey FOREIGN KEY (session_id) REFERENCES chat_sessions(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| ALTER TABLE messages ADD CONSTRAINT messages_user_id_fkey FOREIGN KEY (user_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| ALTER TABLE messages ADD CONSTRAINT messages_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| CREATE TABLE notifications (
  is_global boolean DEFAULT false,
  channels jsonb DEFAULT '["in-app"]'::jsonb,
  target character varying(50),
  action_url text,
  type text,
  message text NOT NULL,
  title text NOT NULL,
  status text DEFAULT 'sent'::text,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  priority text DEFAULT 'medium'::text,
  recipients text DEFAULT 'all'::text,
  user_id uuid NOT NULL,
  is_read boolean DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  sender_id uuid
);                                                                                                                                                                                                                                                                                                                                                                                                            |
| CREATE UNIQUE INDEX notifications_pkey ON public.notifications USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ALTER TABLE notifications ADD CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ALTER TABLE notifications ADD CONSTRAINT notifications_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| CREATE TABLE quiz_attempts (
  student_id uuid NOT NULL,
  quiz_id uuid NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  is_passed boolean DEFAULT false,
  completed_at timestamp with time zone,
  started_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  time_taken_minutes integer,
  max_score integer NOT NULL,
  score integer NOT NULL DEFAULT 0,
  answers jsonb NOT NULL DEFAULT '[]'::jsonb
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| CREATE UNIQUE INDEX quiz_attempts_pkey ON public.quiz_attempts USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ALTER TABLE quiz_attempts ADD CONSTRAINT quiz_attempts_quiz_id_fkey FOREIGN KEY (quiz_id) REFERENCES quizzes(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ALTER TABLE quiz_attempts ADD CONSTRAINT quiz_attempts_student_id_fkey FOREIGN KEY (student_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| CREATE TABLE quizzes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  time_limit_minutes integer,
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  passing_score integer DEFAULT 70,
  is_published boolean DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  title text NOT NULL,
  description text,
  lesson_id uuid,
  course_id uuid,
  questions jsonb NOT NULL DEFAULT '[]'::jsonb,
  max_attempts integer DEFAULT 3
);                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| CREATE UNIQUE INDEX quizzes_pkey ON public.quizzes USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ALTER TABLE quizzes ADD CONSTRAINT quizzes_lesson_id_fkey FOREIGN KEY (lesson_id) REFERENCES lessons(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| ALTER TABLE quizzes ADD CONSTRAINT quizzes_course_id_fkey FOREIGN KEY (course_id) REFERENCES courses(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| CREATE TABLE study_sessions (
  subject_id uuid,
  start_time timestamp with time zone NOT NULL,
  end_time timestamp with time zone,
  duration_minutes integer,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  notes text,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  session_name text NOT NULL,
  user_id uuid NOT NULL,
  course_id uuid
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| CREATE UNIQUE INDEX study_sessions_pkey ON public.study_sessions USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ALTER TABLE study_sessions ADD CONSTRAINT study_sessions_user_id_fkey FOREIGN KEY (user_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ALTER TABLE study_sessions ADD CONSTRAINT study_sessions_subject_id_fkey FOREIGN KEY (subject_id) REFERENCES subjects(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ALTER TABLE study_sessions ADD CONSTRAINT study_sessions_course_id_fkey FOREIGN KEY (course_id) REFERENCES courses(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| CREATE TABLE subjects (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  description text,
  icon text,
  color text DEFAULT '#3B82F6'::text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now())
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| CREATE UNIQUE INDEX subjects_pkey ON public.subjects USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| CREATE UNIQUE INDEX subjects_name_key ON public.subjects USING btree (name);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| CREATE TABLE user_achievements (
  user_id uuid NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  earned_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  metadata jsonb DEFAULT '{}'::jsonb,
  achievement_type text NOT NULL,
  achievement_name text NOT NULL,
  description text
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| CREATE UNIQUE INDEX user_achievements_pkey ON public.user_achievements USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ALTER TABLE user_achievements ADD CONSTRAINT user_achievements_user_id_fkey FOREIGN KEY (user_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| CREATE TABLE user_profiles (
  notification_settings jsonb DEFAULT '{"push": true, "email": true}'::jsonb,
  user_id uuid NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  avatar_url text,
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  address text,
  date_of_birth date,
  phone text,
  bio text,
  learning_preferences jsonb DEFAULT '{}'::jsonb
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| CREATE UNIQUE INDEX user_profiles_pkey ON public.user_profiles USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ALTER TABLE user_profiles ADD CONSTRAINT user_profiles_user_id_fkey FOREIGN KEY (user_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE TABLE user_progress (
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  subject text NOT NULL,
  topic text NOT NULL,
  last_studied timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  progress_data jsonb DEFAULT '{}'::jsonb,
  user_id uuid NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid()
);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| CREATE UNIQUE INDEX user_progress_pkey ON public.user_progress USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| CREATE INDEX idx_user_progress_user_id ON public.user_progress USING btree (user_id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| CREATE UNIQUE INDEX user_progress_user_id_subject_topic_key ON public.user_progress USING btree (user_id, subject, topic);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| ALTER TABLE user_progress ADD CONSTRAINT user_progress_user_id_fkey FOREIGN KEY (user_id) REFERENCES users(id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| CREATE TABLE users (
  avatar text,
  name text NOT NULL,
  website text,
  github text,
  linkedin text,
  twitter text,
  specialization text,
  years_of_experience text,
  education text,
  status text NOT NULL DEFAULT 'active'::text,
  email text NOT NULL,
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  is_suspended boolean DEFAULT false,
  preferences jsonb DEFAULT '{}'::jsonb,
  birth_date date,
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  first_name text,
  password text,
  avatar_url text,
  role text NOT NULL DEFAULT 'student'::text,
  last_name text,
  phone text,
  address text,
  bio text
);                                                                                                                                                                                                            |
| CREATE INDEX idx_users_email ON public.users USING btree (email);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| CREATE INDEX idx_users_first_name ON public.users USING btree (first_name);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| CREATE INDEX idx_users_last_name ON public.users USING btree (last_name);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| CREATE UNIQUE INDEX users_email_key ON public.users USING btree (email);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| CREATE UNIQUE INDEX users_pkey ON public.users USING btree (id);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |